{% extends "layout.html" %}
{% block content %}
<div class="space-y-6">
  <div class="flex items-center justify-between">
    <div>
      <div class="text-sm text-sky-300 tracking-[0.3em] uppercase">Server</div>
      <h1 class="text-3xl font-semibold">ğ™‚ğ™šğ™¤ğ™‡ğ™ğ™«ğ™š ğ™‚ğ™ªğ™ğ™¡ğ™™ ğ™ğ™šğ™©ğ™©ğ™ğ™£ğ™œğ™¨</h1>
      <p class="text-slate-300">Configure feeds, embeds, and API keys.</p>
    </div>
    <button id="save-btn" class="px-4 py-2 rounded-xl bg-gradient-to-r from-sky-500 to-teal-400 text-white shadow-lg shadow-sky-900/40">Save</button>
  </div>

  <div class="grid lg:grid-cols-3 gap-4">
    <div class="lg:col-span-2 space-y-4">
      <div class="rounded-2xl bg-white/5 backdrop-blur-lg border border-white/10 p-4 space-y-3">
        <div class="text-lg font-semibold">Feeds & Alerts</div>
        <div class="grid md:grid-cols-2 gap-3">
          <label class="flex items-center gap-2">
            <input type="checkbox" id="earthquake_feed_enabled" class="accent-sky-400" {% if cfg.earthquake_feed_enabled %}checked{% endif %}>
            <span>Earthquake Feed</span>
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" id="weather_feed_enabled" class="accent-sky-400" {% if cfg.weather_feed_enabled %}checked{% endif %}>
            <span>Weather Feed</span>
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" id="iss_feed_enabled" class="accent-sky-400" {% if cfg.iss_feed_enabled %}checked{% endif %}>
            <span>ISS Alerts</span>
          </label>
          <div>
            <label class="block text-sm text-slate-300 mb-1">Interval (hours)</label>
            <select id="interval" class="w-full bg-white/5 rounded-xl p-2 border border-white/10">
              {% for val in [1,2,4,6,12] %}
                <option value="{{ val }}" {% if cfg.interval == val %}selected{% endif %}>{{ val }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
      </div>

      <div class="rounded-2xl bg-white/5 backdrop-blur-lg border border-white/10 p-4 space-y-3">
        <div class="text-lg font-semibold">Embed Style</div>
        <div class="grid md:grid-cols-3 gap-3">
          <div>
            <label class="block text-sm text-slate-300 mb-1">Primary Color</label>
            <input type="color" id="primary_color" value="{{ cfg.primary_color }}" class="w-full h-12 rounded-xl bg-transparent border border-white/10">
          </div>
          <div>
            <label class="block text-sm text-slate-300 mb-1">Icon URL</label>
            <input type="text" id="icon_url" value="{{ cfg.icon_url }}" class="w-full bg-white/5 rounded-xl p-2 border border-white/10" placeholder="https://...">
          </div>
          <div>
            <label class="block text-sm text-slate-300 mb-1">Banner URL</label>
            <input type="text" id="banner_url" value="{{ cfg.banner_url }}" class="w-full bg-white/5 rounded-xl p-2 border border-white/10" placeholder="https://...">
          </div>
        </div>
        <div class="mt-3 rounded-2xl bg-white/5 border border-white/10 p-4">
          <div class="text-sm text-slate-300 mb-2">Preview</div>
          <div class="rounded-xl bg-gradient-to-r from-sky-900/50 to-teal-800/50 p-4 text-slate-100">
            <div class="text-sky-200">ğŸŒ ğ™‚ğ™šğ™¤ğ™‡ğ™ğ™«ğ™š ğ™‹ğ™§ğ™šğ™«ğ™ğ™šğ™¬</div>
            <div class="text-sm text-slate-200">Your embed styling will appear like this.</div>
          </div>
        </div>
      </div>

      <div class="rounded-2xl bg-white/5 backdrop-blur-lg border border-white/10 p-4 space-y-3">
        <div class="text-lg font-semibold">API Keys</div>
        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm text-slate-300 mb-1">WeatherAPI Key</label>
            <input type="text" id="weather_api_key" value="{{ cfg.weather_api_key }}" class="w-full bg-white/5 rounded-xl p-2 border border-white/10">
          </div>
          <div>
            <label class="block text-sm text-slate-300 mb-1">NASA Key</label>
            <input type="text" id="nasa_key" value="{{ cfg.nasa_key }}" class="w-full bg-white/5 rounded-xl p-2 border border-white/10">
          </div>
        </div>
      </div>
    </div>

    <div class="space-y-4">
      <div class="rounded-2xl bg-white/5 backdrop-blur-lg border border-white/10 p-4">
        <div class="text-lg font-semibold mb-2">Local Weather</div>
        <div class="text-slate-300">Powered by browser location.</div>
        <div id="weather-widget" class="text-sm text-slate-400 mt-2">Live data pending...</div>
      </div>
      <div class="rounded-2xl bg-white/5 backdrop-blur-lg border border-white/10 p-4">
        <div class="text-lg font-semibold mb-2">Nearby Earthquakes</div>
        <div id="quake-widget" class="text-sm text-slate-400">Live data pending...</div>
      </div>
      <div class="rounded-2xl bg-white/5 backdrop-blur-lg border border-white/10 p-4">
        <div class="text-lg font-semibold mb-2">ISS Next Pass</div>
        <div id="iss-widget" class="text-sm text-slate-400">Live data pending...</div>
      </div>
      <div class="rounded-2xl bg-white/5 backdrop-blur-lg border border-white/10 p-4">
        <div class="text-lg font-semibold mb-2">Aurora Forecast</div>
        <div id="aurora-widget" class="text-sm text-slate-400">Live data pending...</div>
      </div>
    </div>
  </div>
</div>

<script>
  const guildId = "{{ guild_id }}";
  const saveBtn = document.getElementById("save-btn");
  saveBtn?.addEventListener("click", async () => {
    const payload = {
      earthquake_feed_enabled: document.getElementById("earthquake_feed_enabled").checked,
      weather_feed_enabled: document.getElementById("weather_feed_enabled").checked,
      iss_feed_enabled: document.getElementById("iss_feed_enabled").checked,
      interval: Number(document.getElementById("interval").value),
      primary_color: document.getElementById("primary_color").value,
      icon_url: document.getElementById("icon_url").value,
      banner_url: document.getElementById("banner_url").value,
      weather_api_key: document.getElementById("weather_api_key").value,
      nasa_key: document.getElementById("nasa_key").value,
    };
    const res = await fetch(`/guild/${guildId}/save`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });
    const json = await res.json();
    if (json.success) {
      saveBtn.textContent = "Saved!";
      setTimeout(() => saveBtn.textContent = "Save", 1500);
    }
  });
</script>
{% endblock %}
